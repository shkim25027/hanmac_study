// ============================================
// 게이지 차트 모듈
// ============================================

export class GaugeChart {
  constructor(config) {
    this.config = {
      size: config.size || 832,
      strokeWidth: config.strokeWidth || 31,
      maxValue: config.maxValue || 50,
      padding: config.padding || 20,
      outerTextOffset: config.outerTextOffset || 6,
      innerTextOffset: config.innerTextOffset || 35,
      dotRadius: config.dotRadius || 7,
    };
    this.svg = null;
    this.center = 0;
    this.radius = 0;
    this.animated = false;
  }

  // 초기화
  init() {
    this.svg = document.getElementById("gauge");
    if (!this.svg) {
      console.error("게이지 SVG 요소를 찾을 수 없습니다");
      return;
    }

    const { size, strokeWidth, padding } = this.config;
    this.center = size / 2;
    this.radius = size / 2 - strokeWidth / 2 - padding;

    // viewBox 크기를 늘려서 아이콘이 잘리지 않도록
    const extraSpace = 100; // 추가 여유 공간
    this.svg.setAttribute(
      "viewBox",
      `-50 -50 ${size + 100} ${size + extraSpace}`
    );
    this.svg.setAttribute("preserveAspectRatio", "xMidYMid meet");
  }

  // 게이지 업데이트
  update(value) {
    if (!this.svg) return;

    const shouldAnimate = !this.animated;
    this.svg.innerHTML = "";

    let percent;

    if (value <= this.config.maxValue) {
      percent = value / this.config.maxValue;
      percent = Math.max(percent, 0.14);
    } else {
      percent = 2 - value / this.config.maxValue;
      percent = Math.max(percent, 0.1);
    }

    const angle = -180 + percent * 180;

    // 텍스트 경로 정의 (먼저 생성)
    this.createTextPaths();

    // 배경 반원
    this.createBackgroundArc(value);

    // 채워진 반원
    this.createFilledArc(angle, value, shouldAnimate);

    // "나의 학습" 텍스트
    this.addMyLearningText(value, percent, angle, shouldAnimate);

    // 끝점 아이콘
    this.addEndIcon(angle, value, shouldAnimate);

    // "전체 평균 학습" 텍스트
    this.addAverageLearningText(value, percent);

    if (shouldAnimate) {
      this.animated = true;
    }
  }

  // 극좌표 → 직교좌표
  polarToCartesian(cx, cy, r, angle) {
    const rad = (angle * Math.PI) / 180;
    return {
      x: cx + r * Math.cos(rad),
      y: cy + r * Math.sin(rad),
    };
  }

  // 원호 경로 생성
  createArcPath(r, startAngle, endAngle) {
    const start = this.polarToCartesian(
      this.center,
      this.center,
      r,
      startAngle
    );
    const end = this.polarToCartesian(this.center, this.center, r, endAngle);
    return `M ${start.x} ${start.y} A ${r} ${r} 0 0 1 ${end.x} ${end.y}`;
  }

  // 텍스트 경로 정의
  createTextPaths() {
    const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");

    // 외곽 텍스트 경로
    const outerArc = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "path"
    );
    outerArc.setAttribute("id", "outerArc");
    outerArc.setAttribute(
      "d",
      this.createArcPath(this.radius - this.config.outerTextOffset, -180, 0)
    );
    defs.appendChild(outerArc);

    // 내부 텍스트 경로
    const innerArc = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "path"
    );
    innerArc.setAttribute("id", "innerArc");
    innerArc.setAttribute(
      "d",
      this.createArcPath(this.radius - this.config.innerTextOffset, -180, 0)
    );
    defs.appendChild(innerArc);

    this.svg.appendChild(defs);
  }

  // 배경 반원 생성
  createBackgroundArc(value) {
    const bg = document.createElementNS("http://www.w3.org/2000/svg", "path");
    bg.setAttribute("d", this.createArcPath(this.radius, -180, 0));
    if (value <= this.config.maxValue) {
      bg.setAttribute("stroke", "#72451F");
      bg.setAttribute("stroke-opacity", "0.1");
    } else {
      bg.setAttribute("stroke", "#D8823B");
    }

    bg.setAttribute("stroke-width", this.config.strokeWidth);
    bg.setAttribute("stroke-linecap", "round");
    bg.setAttribute("fill", "none");
    this.svg.appendChild(bg);
  }

  createFilledArc(angle, value, shouldAnimate) {
    const defs = this.svg.querySelector("defs");

    // linearGradient
    let gradient = defs.querySelector("#arcSweepGradient");

    if (!gradient) {
      gradient = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "linearGradient"
      );
      gradient.setAttribute("id", "arcSweepGradient");
      gradient.setAttribute("x1", "0%");
      gradient.setAttribute("y1", "0%");
      gradient.setAttribute("x2", "100%");
      gradient.setAttribute("y2", "0%");

      const stop1 = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "stop"
      );
      stop1.setAttribute("offset", "0%");
      stop1.setAttribute("stop-color", "#72451F");

      const stop2 = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "stop"
      );
      stop2.setAttribute("offset", "100%");
      stop2.setAttribute("stop-color", "#D8823B");

      gradient.appendChild(stop1);
      gradient.appendChild(stop2);
      defs.appendChild(gradient);
    }

    gradient.setAttribute(
      "gradientTransform",
      `rotate(${angle - 90}, 0.5, 0.5)`
    );

    const fg = document.createElementNS("http://www.w3.org/2000/svg", "path");
    fg.setAttribute(
      "stroke",
      value <= this.config.maxValue ? "#e89555" : "url(#arcSweepGradient)"
    );
    fg.setAttribute("stroke-width", this.config.strokeWidth);
    fg.setAttribute("stroke-linecap", "round");
    fg.setAttribute("fill", "none");

    this.svg.appendChild(fg);

    if (shouldAnimate) {
      const startAngle = -180 + 0.14 * 180; // 15% 시작점
      const fullAngle = 0; // 100% 지점

      // 초기 경로 설정
      fg.setAttribute("d", this.createArcPath(this.radius, -180, startAngle));

      // maxValue 초과 여부에 따라 애니메이션 분기
      if (value > this.config.maxValue) {
        // 초과 시: 15% → 100% → 최종값
        const phase1Duration = 1400; // 1.4초 동안 100%까지
        const phase2Duration = 800; // 0.8초 동안 최종값까지
        const startTime = performance.now();

        const animate = (currentTime) => {
          const elapsed = currentTime - startTime;

          if (elapsed < phase1Duration) {
            // Phase 1: 15% → 100%
            const progress = elapsed / phase1Duration;
            const easeOut = 1 - Math.pow(1 - progress, 3);
            const currentAngle =
              startAngle + (fullAngle - startAngle) * easeOut;
            fg.setAttribute(
              "d",
              this.createArcPath(this.radius, -180, currentAngle)
            );
            requestAnimationFrame(animate);
          } else if (elapsed < phase1Duration + phase2Duration) {
            // Phase 2: 100% → 최종값 (역방향)
            const progress = (elapsed - phase1Duration) / phase2Duration;
            const easeOut = 1 - Math.pow(1 - progress, 3);
            const currentAngle = fullAngle + (angle - fullAngle) * easeOut;
            fg.setAttribute(
              "d",
              this.createArcPath(this.radius, -180, currentAngle)
            );
            requestAnimationFrame(animate);
          } else {
            // 애니메이션 종료
            fg.setAttribute("d", this.createArcPath(this.radius, -180, angle));
          }
        };

        requestAnimationFrame(animate);
      } else {
        // 정상 범위: 15% → 최종값
        const duration = 1400;
        const startTime = performance.now();

        const animate = (currentTime) => {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easeOut = 1 - Math.pow(1 - progress, 3);

          const currentAngle = startAngle + (angle - startAngle) * easeOut;
          fg.setAttribute(
            "d",
            this.createArcPath(this.radius, -180, currentAngle)
          );

          if (progress < 1) {
            requestAnimationFrame(animate);
          }
        };

        requestAnimationFrame(animate);
      }
    } else {
      // 애니메이션 없이 바로 최종 각도
      fg.setAttribute("d", this.createArcPath(this.radius, -180, angle));
    }
  }

  // "나의 학습" 텍스트 추가
  addMyLearningText(value, percent, angle, shouldAnimate) {
    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
    text.setAttribute("font-size", "16");
    text.setAttribute("font-weight", "700");
    text.setAttribute("fill", "#FFF");
    text.setAttribute("stroke", "rgba(0, 0, 0, 0.30)");
    text.setAttribute("stroke-width", "2");
    text.setAttribute("paint-order", "stroke fill");

    const textPath = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "textPath"
    );

    textPath.setAttributeNS(
      "http://www.w3.org/1999/xlink",
      "xlink:href",
      "#outerArc"
    );
    textPath.setAttribute("text-anchor", "middle");
    textPath.textContent = `나의 학습 : ${value}분 ＞`;

    // 최종 위치 계산
    let finalOffset;
    if (value > this.config.maxValue) {
      finalOffset = 95; // 100% 근처에 고정
    } else {
      finalOffset = Math.max(10, percent * 100 - 4.5);
    }

    text.appendChild(textPath);
    this.svg.appendChild(text);

    if (shouldAnimate) {
      // 초기 위치
      textPath.setAttribute("startOffset", "15%");

      // 애니메이션 (최종 위치까지 이동)
      const startOffset = 15;
      const duration = 1400; // 1.4초로 통일
      const startTime = performance.now();

      const animate = (currentTime) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const currentOffset =
          startOffset + (finalOffset - startOffset) * easeOut;

        textPath.setAttribute("startOffset", `${currentOffset}%`);

        if (progress < 1) {
          requestAnimationFrame(animate);
        }
      };

      requestAnimationFrame(animate);
    } else {
      textPath.setAttribute("startOffset", `${finalOffset}%`);
    }
  }

  // 끝점 아이콘 추가
  addEndIcon(angle, value, shouldAnimate) {
    // 70%~100% 사이에는 아이콘 표시하지 않음
    if (value >= this.config.maxValue * 0.7 && value <= this.config.maxValue) {
      return;
    }

    const icon = document.createElementNS("http://www.w3.org/2000/svg", "g");

    // 값에 따라 다른 아이콘 사용
    if (value > this.config.maxValue) {
      // 100% 초과 시: 로켓 아이콘 (18px × 48px, rotate 179.336deg)
      icon.innerHTML = `
        <path d="M9.16529 0.7495C9.3363 6.51321 5.30726 6.73043 5.41571 10.3855C5.52416 14.0406 9.45449 14.6811 9.45449 14.6811C9.45449 14.6811 13.3401 13.8085 13.2314 10.1534C13.1227 6.49827 9.33654 6.51321 9.16529 0.7495Z" fill="url(#paint0_linear_2000_107516)" stroke="#002775" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
        <g opacity="0.5">
          <path d="M8.91926 3.29242C9.98174 6.3472 12.4168 6.92507 12.5033 9.84564C12.6118 13.5008 8.72623 14.3731 8.72623 14.3731C8.72623 14.3731 8.36793 14.3144 7.86466 14.1324C8.71166 14.5678 9.4523 14.6889 9.4523 14.6889C9.4523 14.6889 13.3379 13.8163 13.2294 10.1614C13.121 6.50633 9.33435 6.52102 9.16309 0.757316C9.19294 1.75236 9.09713 2.58181 8.91926 3.29242Z" fill="white"/>
        </g>
        <path d="M9.22533 5.28841C9.32486 8.64391 6.57372 9.78925 6.63675 11.9171C6.69978 14.045 9.49978 14.4029 9.49978 14.4029C9.49978 14.4029 12.2735 13.8797 12.2104 11.7518C12.1474 9.62391 9.32511 8.64391 9.22533 5.28841Z" fill="#FFD553"/>
        <g opacity="0.3">
          <path d="M7.17845 13.7088C6.74639 13.1154 6.44004 12.3502 6.41081 11.3661C6.32107 8.34306 9.06163 7.67154 9.91536 4.2686C9.50364 3.38069 9.20908 2.26596 9.16431 0.752113C9.33531 6.51582 5.30628 6.73305 5.41473 10.3882C5.46351 12.0344 6.28726 13.0687 7.17845 13.7088Z" fill="#002775"/>
        </g>
        <path d="M9.14355 0.294106C9.2987 0.292308 9.42733 0.415304 9.43211 0.571165C9.52435 3.6815 10.7155 5.11622 11.7662 6.38206C12.6404 7.43513 13.4662 8.42986 13.517 10.1483C13.6311 13.9942 9.5585 14.9536 9.51727 14.9627C9.48173 14.9706 9.44487 14.9718 9.40891 14.966C9.36726 14.9593 5.24474 14.2431 5.13061 10.3972C5.07946 8.67433 5.89173 7.63018 6.75155 6.52459C7.78378 5.19773 8.95354 3.6938 8.86135 0.587927C8.86133 0.586195 8.86131 0.584463 8.86129 0.582731C8.85949 0.427578 8.98224 0.298699 9.13835 0.294167C9.13983 0.294149 9.14181 0.294126 9.14355 0.294106ZM9.44607 14.3929C9.91589 14.2726 13.0409 13.3514 12.9465 10.1653C12.9014 8.6433 12.1718 7.76427 11.3269 6.74675C10.5421 5.8013 9.68319 4.76661 9.21287 3.07183C8.81955 4.79593 7.97436 5.88229 7.20208 6.87525C6.37249 7.94163 5.65606 8.86267 5.70112 10.3805C5.79572 13.5658 8.96884 14.3004 9.44607 14.3929Z" fill="#002775"/>
        <path d="M4.71751 17.1326L5.03648 15.7417C5.18089 15.1124 5.65894 14.6134 6.28136 14.4421C8.13506 13.9321 10.0928 13.9391 11.9426 14.4623C12.5639 14.638 13.0384 15.1406 13.1781 15.7708L13.4873 17.1641L4.71751 17.1326Z" fill="#00AAFF"/>
        <path d="M8.94979 14.0062C9.96113 13.9945 10.9737 14.1275 11.9559 14.4054C12.5998 14.5875 13.0896 15.1063 13.2346 15.7595L13.5437 17.1527C13.551 17.1858 13.5301 17.2184 13.4973 17.2257C13.4645 17.2333 13.4316 17.2122 13.4243 17.1793L13.1151 15.7861C12.9798 15.1769 12.523 14.6929 11.9224 14.5231C10.0832 14.003 8.13693 13.9961 6.29409 14.5032C5.69263 14.6686 5.23219 15.1494 5.09248 15.7576L4.77351 17.1484C4.76597 17.1814 4.73305 17.2021 4.70029 17.1943C4.66728 17.1868 4.64685 17.1539 4.65439 17.1211L4.97337 15.7303C5.12296 15.0781 5.61666 14.5626 6.26178 14.3853C7.14201 14.143 8.0456 14.0167 8.94979 14.0062Z" fill="#002775"/>
        <g opacity="0.6">
          <path d="M12.6426 17.103L12.3363 15.7233C12.259 15.3755 12.0893 15.0624 11.853 14.8118C11.6168 14.5616 11.3136 14.3738 10.97 14.2768C10.705 14.2016 10.4378 14.1367 10.1691 14.0809C10.7118 14.1459 11.2506 14.2537 11.7805 14.4037C12.0906 14.4912 12.3653 14.6608 12.5791 14.888C12.793 15.1137 12.9458 15.3968 13.0163 15.7122L13.3252 17.1055L12.6426 17.103Z" fill="white"/>
        </g>
        <g opacity="0.35">
          <path d="M8.88634 14.2034C8.24747 14.2581 7.61249 14.3707 6.98933 14.5422C6.3669 14.7133 5.88885 15.2125 5.74469 15.8421L5.4474 17.1391L13.4853 17.168L13.4193 16.8705L7.46056 16.8495L7.77953 15.4582C7.91286 14.8765 8.33185 14.4064 8.88634 14.2034ZM8.19241 16.8519L13.4195 16.8703L13.4404 16.9641L8.17097 16.9455L8.19241 16.8519Z" fill="#002775"/>
        </g>
        <path d="M14.2083 21.1933C15.8137 21.045 18.5098 19.4167 17.4299 13.6657C17.4157 13.5902 17.3157 13.5713 17.2751 13.6366C16.8342 14.3458 14.7884 17.6938 12.6577 17.6056L14.2083 21.1933Z" fill="#EC1C24"/>
        <path d="M17.3443 13.5411C17.354 13.541 17.3636 13.5419 17.3733 13.5438C17.4328 13.5549 17.4786 13.6004 17.4897 13.66C17.993 16.3401 17.7214 18.4694 16.7041 19.8174C15.8163 20.9936 14.6666 21.218 14.2137 21.2599C14.1804 21.2642 14.1504 21.2383 14.1473 21.2045C14.1442 21.1708 14.1688 21.1411 14.2027 21.138C14.6395 21.0975 15.7482 20.881 16.6067 19.7435C17.6026 18.4238 17.8666 16.3279 17.3697 13.6824C17.3671 13.6691 17.3569 13.665 17.3509 13.664C17.345 13.6629 17.3341 13.6627 17.327 13.6745L17.3061 13.7081C15.226 17.0572 13.6299 17.713 12.6551 17.6723C12.6214 17.671 12.5951 17.6423 12.5964 17.6087C12.5977 17.575 12.6234 17.5489 12.6601 17.55C13.6012 17.5891 15.1531 16.9427 17.2019 13.6435L17.2228 13.6098C17.2498 13.5667 17.2953 13.5417 17.3443 13.5411Z" fill="#002775"/>
        <g opacity="0.6">
          <path d="M16.7955 14.355C16.9974 14.054 17.1485 13.8084 17.236 13.6678C17.2768 13.6023 17.3762 13.6214 17.3907 13.6967C18.4709 19.4479 15.7748 21.0762 14.1691 21.2245L14.0013 20.8359C15.4892 20.4093 17.3516 18.7543 16.7955 14.355Z" fill="white"/>
        </g>
        <path d="M17.3406 13.1709C17.3743 13.1705 17.4087 13.1733 17.443 13.1798C17.6525 13.219 17.8133 13.3797 17.8526 13.5891C18.383 16.4135 18.0958 18.5823 16.9992 20.0354C16.0233 21.3285 14.7514 21.5761 14.2497 21.6222C14.0146 21.6438 13.8057 21.4707 13.7839 21.2351C13.7622 20.9995 13.9355 20.7911 14.1711 20.7693C14.5594 20.7334 15.5454 20.5398 16.3156 19.5194C17.1378 18.4301 17.422 16.7488 17.1501 14.6239C15.5743 16.9477 14.0613 18.0933 12.6421 18.036C12.4059 18.0261 12.2221 17.8268 12.2318 17.5903C12.2417 17.3541 12.44 17.1726 12.6774 17.18C13.3688 17.2089 14.8336 16.7615 16.8924 13.4468L16.9136 13.4129C17.0071 13.2616 17.1679 13.1729 17.3406 13.1709Z" fill="#002775"/>
        <path d="M4.12793 21.1555C2.52335 20.9957 -0.250768 19.3479 0.870094 13.6049C0.884812 13.5295 0.98508 13.5112 1.02519 13.5768C1.46111 14.2893 3.57848 17.6518 5.70973 17.5788L4.12793 21.1555Z" fill="#D25658"/>
        <path d="M0.950944 13.4811C1.00167 13.4806 1.04899 13.5062 1.07623 13.5505C1.81487 14.7578 3.7323 17.5468 5.6617 17.5244C5.67679 17.5242 5.69139 17.5238 5.70623 17.5234C5.70673 17.5234 5.70722 17.5234 5.70772 17.5234C5.74088 17.523 5.7684 17.5492 5.76953 17.5826C5.77067 17.6162 5.74427 17.6447 5.71062 17.6459C3.70654 17.7151 1.72758 14.8494 0.971795 13.6145C0.964732 13.603 0.953597 13.6031 0.947917 13.6042C0.94199 13.6052 0.931639 13.6091 0.929072 13.6225C0.420272 16.2297 0.674823 18.3123 1.66561 19.6447C2.54277 20.8242 3.68315 21.0557 4.13285 21.1005C4.16655 21.1038 4.1909 21.1337 4.18758 21.1674C4.18426 21.2011 4.15485 21.2265 4.12065 21.2222C3.65484 21.1758 2.47353 20.9363 1.56746 19.7176C0.555555 18.3568 0.29319 16.2408 0.808765 13.5989C0.820452 13.5396 0.866455 13.4943 0.925974 13.4834C0.934373 13.4821 0.942778 13.4812 0.950944 13.4811Z" fill="#002775"/>
        <path d="M0.869849 13.6051C0.885064 13.53 0.985086 13.5117 1.0252 13.5773C1.2487 13.942 1.91312 15.0022 2.79489 15.9399C3.62781 16.8261 4.65522 17.6027 5.68696 17.5793C5.69439 17.5795 5.7023 17.5787 5.70973 17.5788L5.70033 17.6005L4.12842 21.1555C3.67797 21.1108 3.13534 20.9488 2.61269 20.6111C1.27294 19.7483 0.0639157 17.7366 0.869849 13.6051Z" fill="#EC1C24"/>
        <path d="M0.950531 13.4818C1.00126 13.4812 1.04883 13.5069 1.07582 13.5511C1.62675 14.45 2.23584 15.2636 2.83797 15.9036C3.85783 16.9891 4.80806 17.5342 5.66251 17.5243C5.66969 17.5242 5.67687 17.5241 5.68404 17.524L5.70854 17.5235C5.72908 17.5235 5.74826 17.5342 5.7596 17.5514C5.77093 17.5686 5.77267 17.5903 5.76447 17.6092L5.75507 17.6309L4.18292 21.1862C4.17231 21.2103 4.14724 21.2252 4.12097 21.2223C3.59842 21.1702 3.05068 20.9736 2.57816 20.6685C1.53364 19.9958 -0.0853993 18.1827 0.8086 13.5995C0.808597 13.5992 0.808597 13.5992 0.808594 13.599C0.820529 13.5397 0.866786 13.4949 0.926555 13.4843C0.934456 13.4827 0.942612 13.4819 0.950531 13.4818ZM5.61394 17.6469C4.73797 17.637 3.77423 17.0792 2.74861 15.9875C2.14097 15.3414 1.5266 14.5212 0.971382 13.6152C0.964316 13.6034 0.953178 13.6033 0.947502 13.6046C0.941574 13.6056 0.931223 13.6095 0.928411 13.6231C0.0481915 18.1353 1.6257 19.9098 2.64428 20.5657C3.08763 20.8519 3.59864 21.0395 4.08882 21.0959L5.61394 17.6469Z" fill="#002775"/>
        <g opacity="0.35">
          <path d="M2.79673 15.9437C3.62965 16.8299 4.65706 17.6065 5.6888 17.5831C5.69309 17.5903 5.69788 17.5974 5.70217 17.6043L4.13026 21.1593C3.67981 21.1146 3.13718 20.9526 2.61453 20.6149C2.22772 19.4628 2.17504 17.9288 2.79673 15.9437Z" fill="#002775"/>
        </g>
        <path d="M0.953315 13.1107C1.13173 13.1086 1.29884 13.1992 1.3947 13.3555C1.94943 14.2621 3.90221 17.2177 5.69945 17.1533C5.93352 17.1486 6.13411 17.3304 6.14205 17.5667C6.14998 17.8032 5.96493 18.0013 5.72868 18.0093C3.8868 18.0663 2.13778 15.9926 1.15171 14.5547C0.870612 16.651 1.14787 18.3222 1.96569 19.4222C2.77748 20.5141 3.8619 20.7005 4.17484 20.7318C4.41023 20.7553 4.58194 20.9649 4.55868 21.2003C4.53542 21.4357 4.32433 21.6077 4.09018 21.5841C3.57581 21.5329 2.27221 21.2696 1.27866 19.9333C0.188057 18.4668 -0.0891241 16.3106 0.454487 13.5253C0.495373 13.3162 0.657115 13.1569 0.867037 13.1189C0.895684 13.1136 0.92461 13.111 0.953315 13.1107Z" fill="#002775"/>
        <path d="M9.02399 48.1161C9.02399 48.1161 1.86992 43.8693 1.10117 32.1008C0.446902 22.0748 4.75001 17.0415 4.75001 17.0415C6.54137 16.385 8.44602 16.1491 10.3181 16.3313C11.4056 16.4375 12.4818 16.6846 13.5203 17.0735C13.5203 17.0735 15.4254 19.3332 16.4726 23.8219C16.5085 23.9762 16.5438 24.1339 16.5776 24.2936C16.9459 26.0302 17.182 28.0784 17.1393 30.4362C17.1299 30.9924 17.1039 31.5659 17.0612 32.1568C17.0598 32.1801 17.0578 32.2034 17.0556 32.2265C16.8783 34.6083 16.4402 36.678 15.8566 38.4644C15.8382 38.5218 15.8193 38.5779 15.8004 38.6343C13.493 45.5068 9.02399 48.1161 9.02399 48.1161Z" fill="white"/>
        <path d="M8.95838 16.2105C9.41468 16.2052 9.87102 16.2244 10.3247 16.2684C11.4253 16.3759 12.5077 16.6267 13.5422 17.0141C13.5522 17.0177 13.5607 17.0241 13.5677 17.0319C13.5868 17.0547 15.4943 19.3545 16.5329 23.8059C16.5688 23.9606 16.6043 24.1189 16.6381 24.2789C17.0504 26.223 17.2398 28.2943 17.2012 30.435C17.1918 30.9895 17.1656 31.5694 17.123 32.1589C17.1217 32.1807 17.1198 32.203 17.1178 32.2253C16.9529 34.4405 16.5484 36.5441 15.9158 38.4811C15.8981 38.5355 15.8801 38.5894 15.862 38.6433C13.5709 45.4673 9.10035 48.141 9.05561 48.167C9.03644 48.1784 9.01268 48.1782 8.99349 48.1668C8.97555 48.1561 7.17289 47.0697 5.30245 44.5562C3.57807 42.2386 1.43872 38.197 1.04065 32.1028C0.392135 22.1671 4.66086 17.0503 4.70408 16.9998C4.71092 16.9918 4.71976 16.9857 4.72962 16.9822C6.0769 16.4884 7.51721 16.2272 8.95838 16.2105ZM13.4836 17.123C12.4638 16.7428 11.397 16.4963 10.3125 16.3903C8.45003 16.2092 6.53977 16.4516 4.78657 17.0914C4.55571 17.373 0.532478 22.4463 1.16232 32.0949C1.55827 38.1558 3.68325 42.1741 5.39608 44.4778C7.11771 46.7934 8.77891 47.8879 9.02447 48.0424C9.42548 47.7927 13.5704 45.083 15.7428 38.6125C15.7634 38.5511 15.7813 38.4977 15.7988 38.4433C16.4285 36.5155 16.8309 34.4218 16.995 32.2195C16.9974 32.1933 16.9994 32.1722 17.0006 32.1509C17.043 31.5626 17.0693 30.9849 17.0787 30.4327C17.1173 28.3011 16.9286 26.2393 16.5184 24.304C16.4846 24.1448 16.4494 23.9873 16.4137 23.8335C15.4207 19.5793 13.6337 17.3078 13.4836 17.123Z" fill="#002775"/>
        <path d="M2.6564 39.734C6.84651 40.6449 11.1834 40.6605 15.3807 39.7793C12.9977 45.8671 8.98808 48.208 8.98808 48.208C8.98808 48.208 4.99612 45.8386 2.6564 39.734Z" fill="#EC1C24"/>
        <path d="M2.65638 39.6751C2.66083 39.675 2.66554 39.6755 2.67 39.6764C6.87946 40.5916 11.152 40.6066 15.3686 39.7215C15.391 39.717 15.4134 39.7247 15.4279 39.7418C15.4425 39.759 15.4465 39.7827 15.4383 39.8036C13.0748 45.8415 9.05988 48.2394 9.01956 48.2628C9.00039 48.2742 8.97663 48.274 8.95744 48.2626C8.91732 48.2388 4.92025 45.8122 2.59991 39.7577C2.592 39.7367 2.59593 39.7129 2.61059 39.6959C2.62231 39.6829 2.63905 39.6753 2.65638 39.6751ZM9.47274 40.4947C7.22785 40.5207 4.98301 40.2958 2.75507 39.82C4.95568 45.4745 8.61395 47.9013 8.98916 48.1385C9.3656 47.9042 13.0421 45.5035 15.2831 39.8645C13.3538 40.2621 11.4133 40.4722 9.47274 40.4947Z" fill="#002775"/>
        <g opacity="0.35">
          <path d="M1.94127 32.2532C2.606 42.4346 8.0495 46.9856 9.50617 48.0282C9.46295 48.0579 9.42464 48.0836 9.391 48.1058C9.52682 48.0163 9.74532 47.8648 10.0257 47.645C8.06269 45.6468 5.31305 41.8201 4.43054 35.5244C5.1382 37.0909 6.71054 38.1844 8.54201 38.1909C11.0427 38.1998 13.0771 36.1797 13.086 33.679C13.0949 31.1783 11.0748 29.1439 8.57413 29.1347C6.4521 29.1272 4.66651 30.5808 4.16862 32.5494C3.99996 28.2265 4.75542 24.8864 5.62627 22.5338C6.80981 19.3367 9.97706 17.3015 13.3718 17.617C13.3906 17.6188 13.4092 17.6206 13.428 17.6223C13.5626 17.6354 13.6969 17.6514 13.8312 17.6689C13.8879 17.6729 13.9446 17.6757 14.0016 17.681C14.0205 17.6828 14.039 17.6845 14.0579 17.6863C14.0779 17.6883 14.0978 17.691 14.1178 17.693C13.8804 17.3402 13.7306 17.1617 13.7306 17.1617C12.8136 16.8182 11.867 16.5856 10.9093 16.4631C9.1176 16.3242 7.30287 16.5668 5.59036 17.1945C5.59037 17.1947 1.28701 22.228 1.94127 32.2532Z" fill="#002775"/>
        </g>
        <g opacity="0.35">
          <path d="M14.117 17.6868C14.1206 17.6924 14.124 17.6973 14.1279 17.7031C14.1243 17.6975 14.1206 17.6924 14.117 17.6868Z" fill="#002775"/>
        </g>
        <g opacity="0.35">
          <path d="M14.1299 17.7031C14.1289 17.7018 14.128 17.7004 14.1271 17.699C14.128 17.7009 14.1289 17.7018 14.1299 17.7031Z" fill="#002775"/>
        </g>
        <g opacity="0.6">
          <path d="M8.44482 47.7711C8.76162 48.007 8.94901 48.1182 8.94901 48.1182C8.94901 48.1182 12.9586 45.7773 15.3416 39.6894C15.0706 39.7463 14.7992 39.7994 14.527 39.8486C12.402 44.9673 9.15737 47.3048 8.44482 47.7711Z" fill="white"/>
        </g>
        <path d="M2.65397 39.3085C2.68589 39.3081 2.7181 39.3112 2.74986 39.3183C6.9087 40.2224 11.1295 40.2376 15.2952 39.3629C15.449 39.3309 15.6085 39.3853 15.7102 39.5054C15.8118 39.6255 15.8395 39.7917 15.782 39.9381C13.8841 44.7866 10.9533 47.3242 9.78133 48.1901C9.307 48.5403 8.67143 48.5381 8.19983 48.1842C7.03443 47.3102 4.12255 44.752 2.25904 39.89C2.20264 39.7431 2.2314 39.577 2.33396 39.4577C2.41528 39.3633 2.53247 39.3099 2.65397 39.3085ZM9.4786 40.8626C7.43315 40.8863 5.38779 40.7041 3.35514 40.3161C5.1355 44.4948 7.66752 46.7141 8.71408 47.4991C8.88061 47.6241 9.10508 47.625 9.27268 47.501C10.3251 46.7236 12.8732 44.5221 14.6833 40.3563C12.9538 40.6738 11.2162 40.8424 9.4786 40.8626Z" fill="#002775"/>
        <path d="M8.90384 15.9367C8.97065 15.9359 9.03722 15.9356 9.10404 15.9359C10.6566 15.9414 12.1809 16.2202 13.6345 16.7649C13.7033 16.7906 13.7642 16.8337 13.8117 16.89C13.9906 17.1023 18.1825 22.2029 17.4524 32.2806C17.2527 35.0362 16.6901 37.6119 15.7798 39.9364C15.7272 40.0709 15.6103 40.1698 15.469 40.1994C11.1863 41.0984 6.84695 41.0834 2.57126 40.1546C2.42961 40.1258 2.30917 40.0267 2.25584 39.8883C1.36212 37.5574 0.817691 34.9777 0.637734 32.2208C-0.0206509 22.1382 4.20851 17.0674 4.38871 16.8565C4.43658 16.8007 4.49795 16.7579 4.56695 16.7326C5.9623 16.2215 7.42035 15.9539 8.90384 15.9367ZM13.2221 17.526C11.8976 17.0441 10.5118 16.7976 9.10086 16.7927C7.68889 16.7878 6.302 17.0246 4.97353 17.4969C4.43881 18.1889 0.903188 23.139 1.4924 32.1652C1.66122 34.7507 2.1595 37.1715 2.97367 39.3649C6.98353 40.2052 11.0489 40.2199 15.0651 39.4081C15.8951 37.2206 16.4105 34.8032 16.5976 32.219C17.2516 23.1967 13.7519 18.2217 13.2221 17.526Z" fill="#002775"/>
        <path d="M8.94698 13.739C9.98406 13.727 11.0219 13.8634 12.0292 14.1483C12.7682 14.3572 13.3304 14.9526 13.4965 15.7023L13.8057 17.0955C13.8451 17.273 13.7331 17.4488 13.5556 17.4882C13.3781 17.5274 13.2023 17.4156 13.1629 17.2381L12.8537 15.8449C12.7399 15.3322 12.3553 14.9248 11.8497 14.7817C10.0575 14.2751 8.16116 14.2681 6.36544 14.7623C5.85896 14.9016 5.47139 15.3063 5.35407 15.8182L5.0351 17.2091C4.99459 17.3862 4.81818 17.4972 4.64075 17.4564C4.46358 17.4159 4.35288 17.2393 4.3934 17.0621L4.71237 15.6712C4.88411 14.9228 5.45068 14.3314 6.19078 14.1278C7.09345 13.879 8.01978 13.7498 8.94698 13.739Z" fill="#002775"/>
        <path d="M8.99318 29.9001C6.7445 29.9262 4.94272 31.7702 4.96879 34.0189C4.99485 36.2676 6.8389 38.0694 9.08758 38.0433C11.3363 38.0172 13.138 36.1732 13.112 33.9245C13.0859 31.6758 11.2419 29.874 8.99318 29.9001Z" fill="#EC1C24"/>
        <path d="M8.9924 29.8371C9.01368 29.8368 9.03447 29.8366 9.05576 29.8368C10.1598 29.8408 11.1961 30.2743 11.9739 31.0577C12.7517 31.8412 13.178 32.8806 13.174 33.9845C13.1658 36.2634 11.3013 38.1068 9.02635 38.103C6.7474 38.0947 4.89988 36.2343 4.90786 33.9553C4.91609 31.6974 6.74256 29.8631 8.9924 29.8371ZM9.08928 37.9802C10.1372 37.9681 11.1214 37.556 11.8669 36.816C12.6271 36.0613 13.0478 35.0556 13.0517 33.9841C13.0557 32.9127 12.642 31.9041 11.8871 31.1439C11.1323 30.3837 10.1266 29.963 9.05519 29.9591C9.03465 29.9591 9.01411 29.9591 8.99357 29.9593C6.81029 29.9846 5.03813 31.7645 5.03037 33.9554C5.0226 36.167 6.81528 37.9724 9.02666 37.9802C9.04746 37.9804 9.06849 37.9805 9.08928 37.9802Z" fill="#002775"/>
        <g opacity="0.6">
          <path d="M8.03867 37.9223C8.13106 37.9294 8.22367 37.933 8.31722 37.9332C10.5657 37.9415 12.3951 36.1245 12.4035 33.876C12.4107 31.8936 11.0001 30.2372 9.12505 29.8671C11.246 30.0153 12.9163 31.7865 12.9091 33.9429C12.9008 36.1922 11.0714 38.0084 8.82213 38.0006C8.55409 37.9995 8.29194 37.9726 8.03867 37.9223Z" fill="white"/>
        </g>
        <g opacity="0.35">
          <path d="M4.97195 33.9525C4.98004 31.7042 6.80869 29.887 9.05769 29.8951C9.76479 29.8978 10.4294 30.0806 11.0078 30.4004C10.7147 30.3325 10.4099 30.2957 10.0958 30.2944C7.84682 30.2863 6.01717 32.1028 6.00909 34.3518C6.0037 35.8937 6.85703 37.2385 8.11811 37.9329C6.31006 37.5131 4.96519 35.8881 4.97195 33.9525Z" fill="#371A45"/>
          <path d="M8.9928 29.8324C9.01408 29.8321 9.03512 29.8321 9.0564 29.8321C9.7489 29.8347 10.4333 30.0122 11.036 30.345C11.0627 30.3598 11.0745 30.3921 11.0637 30.4204C11.0528 30.4487 11.0228 30.4649 10.9928 30.4581C10.6995 30.39 10.3974 30.3549 10.0945 30.3537C9.02574 30.347 8.01439 30.7634 7.2542 31.5181C6.49401 32.2728 6.0733 33.2786 6.06939 34.35C6.06413 35.8171 6.86012 37.1688 8.1466 37.8776C8.17326 37.8924 8.18526 37.9244 8.17421 37.953C8.1634 37.9816 8.13339 37.9975 8.10337 37.9907C6.21641 37.5527 4.90304 35.8912 4.90974 33.9504C4.91748 31.6927 6.74345 29.8584 8.9928 29.8324ZM10.5819 30.2616C10.1007 30.0618 9.58078 29.9562 9.05584 29.9544C9.0353 29.9544 9.01451 29.9544 8.99397 29.9546C6.81118 29.9799 5.03927 31.7596 5.03151 33.9507C5.02539 35.6864 6.10729 37.1919 7.71029 37.75C6.60796 36.9787 5.94189 35.7126 5.94663 34.3494C5.95066 33.2453 6.38437 32.209 7.1678 31.431C7.95124 30.6532 8.99244 30.2281 10.0948 30.2309C10.2576 30.232 10.4206 30.2422 10.5819 30.2616Z" fill="#002775"/>
        </g>
        <path d="M8.99137 29.5617C9.01389 29.5614 9.03616 29.5612 9.05893 29.5614C11.4856 29.5701 13.4529 31.5515 13.4444 33.9782C13.4356 36.4049 11.4529 38.3776 9.02758 38.3636C6.60087 38.3549 4.63365 36.3735 4.64214 33.9468C4.6509 31.5427 6.59577 29.5895 8.99137 29.5617ZM9.08825 37.7049C10.0662 37.6935 10.9846 37.3092 11.6804 36.6183C12.3897 35.9139 12.7825 34.9753 12.786 33.9757C12.7895 32.976 12.4037 32.0349 11.6993 31.3253C10.9949 30.616 10.0563 30.2233 9.05666 30.2197C9.03761 30.2197 9.0183 30.2197 8.99925 30.2199C6.96172 30.2435 5.30796 31.9045 5.30073 33.9491C5.29347 36.0127 6.96646 37.6978 9.03009 37.705C9.04939 37.7051 9.06894 37.7051 9.08825 37.7049Z" fill="#002775"/>
        <path d="M9.05761 31.4236C7.627 31.4402 6.48071 32.6133 6.4973 34.0439C6.51388 35.4745 7.68706 36.6208 9.11767 36.6042C10.5483 36.5877 11.6946 35.4145 11.678 33.9839C11.6614 32.5533 10.4882 31.407 9.05761 31.4236Z" fill="#6BD6F0"/>
        <g opacity="0.3">
          <path d="M6.50216 34.0077C6.50735 32.5769 7.67125 31.4218 9.10203 31.4267C9.41165 31.4276 9.70927 31.4831 9.98392 31.5846C9.95519 31.5832 9.92648 31.5827 9.89703 31.5826C8.46625 31.5774 7.30211 32.7328 7.29716 34.1636C7.29283 35.2847 8.00134 36.2415 8.99601 36.6059C7.60628 36.5549 6.49737 35.4088 6.50216 34.0077Z" fill="white"/>
        </g>
        <g opacity="0.35">
          <path d="M7.99677 36.3892C8.04109 36.3911 8.08541 36.3929 8.1307 36.3928C9.56148 36.398 10.7256 35.2426 10.7306 33.8118C10.7347 32.735 10.0807 31.8088 9.14709 31.4155C10.5156 31.4904 11.5991 32.626 11.5941 34.0117C11.5889 35.4417 10.4258 36.5976 8.99502 36.5927C8.64109 36.5911 8.30343 36.5195 7.99677 36.3892Z" fill="#002775"/>
        </g>
        <path d="M9.05217 31.1242C9.06726 31.1241 9.08211 31.1239 9.09721 31.124C9.87088 31.1266 10.5971 31.4305 11.1422 31.9796C11.6874 32.5286 11.9861 33.257 11.9832 34.0306C11.9805 34.8043 11.6766 35.5305 11.1276 36.0756C10.5785 36.6208 9.8519 36.9183 9.0765 36.9166C8.30283 36.9139 7.57665 36.61 7.0315 36.061C6.48636 35.512 6.18762 34.7836 6.19053 34.0099C6.19319 33.2363 6.4971 32.5101 7.04614 31.9649C7.58441 31.4306 8.29521 31.133 9.05217 31.1242ZM9.11445 36.3046C9.71131 36.2977 10.2721 36.063 10.6966 35.6413C11.1297 35.2114 11.3693 34.6384 11.3714 34.0283C11.3758 32.7686 10.3547 31.7402 9.09489 31.7358C7.83882 31.7285 6.80679 32.7525 6.80234 34.0122C6.79789 35.272 7.81906 36.3003 9.07882 36.3048C9.0907 36.3049 9.10257 36.3048 9.11445 36.3046Z" fill="#002775"/>
        <g opacity="0.2">
          <path d="M10.8724 43.915C11.454 44.126 12.3805 43.1124 12.6449 42.4352C12.9186 41.7336 12.9659 41.2649 12.6287 41.127C12.1577 40.9342 11.7737 41.4123 11.4908 42.0497C11.2904 42.5004 10.1544 43.6545 10.8724 43.915Z" fill="white"/>
        </g>
        <g opacity="0.2">
          <path d="M9.44086 45.389C9.95379 45.5501 10.6578 45.1333 10.8261 44.8208C11.0006 44.497 11.0016 44.2676 10.703 44.1664C10.2858 44.0249 9.99883 44.2265 9.81139 44.5175C9.67865 44.7232 8.80796 45.1899 9.44086 45.389Z" fill="white"/>
        </g>
        <path d="M7.58913 17.6103C7.5968 15.6031 9.19276 13.6324 9.19276 13.6324C9.19276 13.6324 9.19879 13.64 9.2091 13.654C9.37894 13.8733 10.7741 15.7363 10.7682 17.6209C10.7622 19.4296 9.44901 20.8783 9.20471 21.1321C9.17952 21.1581 9.16582 21.1714 9.16582 21.1714C9.16582 21.1714 7.58106 19.6039 7.58913 17.6103Z" fill="#EC1C24"/>
        <path d="M9.18881 13.5773C9.18905 13.5773 9.18905 13.5773 9.1893 13.5773C9.20762 13.5773 9.22528 13.5855 9.23683 13.5998C9.23683 13.5998 9.24361 13.6081 9.25517 13.6236C9.41572 13.8311 10.8322 15.7163 10.8261 17.627C10.82 19.4533 9.5084 20.9074 9.24552 21.1804C9.21935 21.2074 9.20515 21.2212 9.20515 21.2212C9.18117 21.2445 9.14305 21.2442 9.11952 21.2207C9.10349 21.2048 7.51671 19.6118 7.52475 17.6158C7.53244 15.6103 9.12569 13.6196 9.14179 13.5996C9.15327 13.5859 9.17049 13.5775 9.18881 13.5773ZM9.16304 21.0898C9.43251 20.8087 10.6981 19.394 10.7038 17.6269C10.7095 15.8479 9.44834 14.0829 9.18919 13.7389C8.92422 14.0875 7.65401 15.8504 7.64726 17.6166C7.63996 19.3778 8.91221 20.8225 9.16304 21.0898Z" fill="#002775"/>
        <g opacity="0.6">
          <path d="M8.92949 21.23C8.92949 21.23 8.8331 21.1343 8.68829 20.9613C9.1203 20.4616 10.0783 19.1804 10.0832 17.6357C10.0881 16.1201 9.1867 14.6184 8.74613 13.9743C8.87371 13.7927 8.95642 13.6903 8.95642 13.6903C8.95642 13.6903 8.96246 13.6984 8.97326 13.7121C9.1426 13.9314 10.5378 15.7946 10.5319 17.6793C10.5261 19.488 9.21317 20.9362 8.96862 21.1899C8.94294 21.2165 8.92949 21.23 8.92949 21.23Z" fill="white"/>
        </g>
        <g opacity="0.35">
          <path d="M7.58684 17.6084C7.59451 15.6012 9.19048 13.6305 9.19048 13.6305C9.19048 13.6305 9.1965 13.6381 9.20681 13.6521L9.20243 21.1302C9.17724 21.1562 9.16353 21.1695 9.16353 21.1695C9.16353 21.1695 7.57877 19.602 7.58684 17.6084Z" fill="#002775"/>
        </g>
        <path d="M9.188 13.3024C9.18974 13.3024 9.19122 13.3024 9.19295 13.3024C9.29269 13.3027 9.38677 13.3484 9.44905 13.4261C9.5166 13.5107 11.1033 15.5229 11.0964 17.6215C11.0897 19.7294 9.46405 21.3386 9.3948 21.4059C9.26657 21.5312 9.06114 21.5306 8.93346 21.4044C8.86486 21.3364 7.25078 19.7157 7.25876 17.6078C7.26686 15.5093 8.86767 13.5083 8.93574 13.4241C8.99772 13.3482 9.09001 13.3036 9.188 13.3024ZM9.1661 20.6785C9.58647 20.1782 10.4333 18.9997 10.4379 17.6194C10.4424 16.2354 9.62003 14.8323 9.18967 14.1931C8.75478 14.8292 7.9226 16.2265 7.91711 17.6103C7.91188 18.9953 8.74921 20.1765 9.1661 20.6785Z" fill="#002775"/>
        <defs>
          <linearGradient id="paint0_linear_2000_107516" x1="8.29857" y1="0.83186" x2="9.80782" y2="14.6306" gradientUnits="userSpaceOnUse">
            <stop stop-color="#EC1C24"/>
            <stop offset="0.1253" stop-color="#ED2124"/>
            <stop offset="0.2806" stop-color="#EE3124"/>
            <stop offset="0.4518" stop-color="#F14A25"/>
            <stop offset="0.6344" stop-color="#F56D26"/>
            <stop offset="0.824" stop-color="#FA9A27"/>
            <stop offset="1" stop-color="#FFCA28"/>
          </linearGradient>
        </defs>
      `;
    } else {
      // 50% 미만: 달팽이 아이콘 (50px × 43px, rotate -30.21deg)
      icon.innerHTML = `
          <g style="mix-blend-mode:hard-light">
            <path d="M11.4043 34.2518C12.6299 32.7145 14.4949 31.7052 16.4572 31.5166C17.5191 32.5994 17.8833 34.5133 17.2722 37.5885C14.9648 37.3875 12.7631 36.1345 11.405 34.2518L11.4043 34.2518Z" fill="#AA6144"/>
            <path d="M15.9262 31.4559C15.9661 31.1047 16.3095 30.8793 16.6292 30.7314C17.6382 30.2656 18.7727 30.0732 19.8829 30.1795C22.1824 31.3375 23.1546 34.0187 22.5204 38.5448C20.703 39.6543 18.1951 39.5038 16.5069 38.1843C16.1886 37.9356 15.8853 37.628 15.7896 37.2357C15.6672 36.7343 15.9088 36.2296 16.0776 35.7441C16.4929 34.5515 16.4829 33.2124 16.0489 32.0209C15.9824 31.8376 15.905 31.6486 15.9262 31.4559Z" fill="#AA6144"/>
            <path d="M16.406 31.8891C16.7032 32.7363 16.8164 33.6238 16.7332 34.5157C16.6928 34.9479 16.5989 35.3693 16.4648 35.7811C16.3119 36.2508 16.0746 36.697 16.168 37.2044C16.2546 37.671 15.52 37.7344 15.4345 37.2707C15.2751 36.4103 15.8228 35.5926 15.9585 34.7611C16.1015 33.883 16.0121 32.9889 15.717 32.1481C15.5597 31.6998 16.2479 31.4408 16.4052 31.8891L16.406 31.8891Z" fill="black"/>
            <path d="M49.7223 21.9292C49.6872 20.0744 50.0351 18.2501 50.7587 16.5458C50.9436 16.1103 51.613 16.4229 51.4274 16.8592C50.7561 18.4389 50.4223 20.142 50.4549 21.8631C50.4642 22.3336 49.7306 22.4042 49.7216 21.9293L49.7223 21.9292Z" fill="black"/>
            <path d="M50.6433 32.4094C49.2142 34.3633 49.4132 37.0216 48.6319 39.3042C47.7982 41.7401 45.7561 43.7403 43.2774 44.5489C40.9998 45.2914 38.5269 45.0539 36.1312 45.2181C34.0152 45.3637 31.9323 45.8285 29.816 45.9631C27.2343 46.1278 24.6478 45.8008 22.0806 45.4743C19.9478 45.2033 17.8158 44.9321 15.6831 44.6603C15.369 44.6206 14.9787 44.511 14.9356 44.2023C14.8924 43.8937 15.2372 43.6867 15.5276 43.566C19.2165 42.0358 22.9055 40.5063 26.5944 38.9761L37.3411 32.1105C38.9644 31.9879 40.2353 30.6571 40.9817 29.2355C41.7281 27.8131 42.1246 26.2242 42.9552 24.8482C44.015 23.0924 45.8192 21.7476 47.8652 21.3977C49.9113 21.0477 52.1601 21.7702 53.4749 23.3585C54.7905 24.9468 55.0252 27.3713 53.8923 29.082C53.0366 30.3746 51.56 31.1586 50.6441 32.4101L50.6433 32.4094Z" fill="#EECEB5"/>
            <path d="M19.3795 29.9009C19.5173 28.8803 22.554 26.4911 26.0966 27.1882C28.6699 29.9085 29.4091 35.5049 26.7245 41.0726C24.3161 42.4835 20.3783 40.4846 20.4716 39.1041C20.5093 38.5467 22.2164 35.1234 19.8198 31.1342C19.5898 30.7518 19.3193 30.3413 19.3794 29.9002L19.3795 29.9009Z" fill="#AA6144"/>
            <path d="M19.8922 32.0218C19.6326 31.4871 19.2421 31.0005 19.0706 30.4283C18.935 29.9749 19.6226 29.7137 19.7591 30.1692C19.9295 30.7371 20.3221 31.2309 20.5807 31.7627C20.8244 32.2626 21.0215 32.7859 21.1665 33.322C21.4088 34.221 21.505 35.1398 21.4606 36.0676C21.4274 36.7657 21.3111 37.455 21.1319 38.1285C21.0406 38.4706 20.8769 38.8289 20.8438 39.1835C20.7997 39.6546 20.0734 39.5225 20.1175 39.0522C20.1489 38.7177 20.3021 38.3804 20.3894 38.0579C20.5607 37.4251 20.6803 36.7784 20.7244 36.1238C20.7836 35.2353 20.6903 34.3229 20.446 33.4641C20.3048 32.9676 20.1183 32.4848 19.8929 32.021L19.8922 32.0218Z" fill="black"/>
            <path d="M41.4829 32.2982C42.4718 42.493 28.8729 44.7015 26.3516 40.7456C25.7057 39.7316 26.3106 38.4142 26.6687 37.2736C27.7178 33.9278 27.1479 30.1038 25.1658 27.1893C30.0515 21.3862 40.8134 25.3849 41.4837 32.2981L41.4829 32.2982Z" fill="#AA6144"/>
            <path d="M25.4793 26.969C26.7985 28.9322 27.5308 31.2645 27.5669 33.6235C27.585 34.8004 27.4442 35.9799 27.1165 37.1095C26.8215 38.1252 26.0526 39.508 26.6632 40.541C26.9038 40.9479 26.3072 41.3779 26.0656 40.9689C25.4453 39.919 25.7962 38.7768 26.1555 37.7057C26.5387 36.5607 26.797 35.3943 26.8315 34.1801C26.8995 31.7872 26.2224 29.3906 24.8825 27.3967C24.6171 27.0017 25.2146 26.5739 25.48 26.9689L25.4793 26.969Z" fill="black"/>
            <path d="M46.3708 23.0855C45.6639 21.1321 45.3951 19.0681 45.5622 17.0039C45.6003 16.5326 46.3267 16.6654 46.2885 17.1352C46.1319 19.0637 46.3992 21.0035 47.0593 22.8264C47.221 23.2737 46.5324 23.5329 46.3708 23.0855Z" fill="black"/>
            <path d="M47.4941 26.6044C47.0168 25.9068 47.372 24.9349 48.0408 24.6494C49.0998 24.1964 50.1305 25.0275 49.9757 26.1152C49.8199 27.2067 48.1824 27.6103 47.4941 26.6044Z" fill="black"/>
            <path d="M48.691 25.6901C48.5532 25.489 48.6562 25.2092 48.8485 25.1262C49.1537 24.9953 49.4512 25.2353 49.4063 25.549C49.3613 25.8634 48.8891 25.9798 48.691 25.6901Z" fill="white"/>
            <path d="M51.8 25.7973C51.3701 25.1687 51.6904 24.2937 52.293 24.0356C53.247 23.6276 54.1757 24.3762 54.0357 25.3561C53.8952 26.339 52.4201 26.703 51.8 25.7973Z" fill="black"/>
            <path d="M52.8713 24.9709C52.7473 24.7899 52.8396 24.5377 53.0135 24.463C53.2889 24.3451 53.5561 24.5613 53.5162 24.8435C53.4757 25.1272 53.0504 25.2319 52.872 24.9708L52.8713 24.9709Z" fill="white"/>
            <path d="M52.8012 28.2039C53.1179 28.5506 52.6453 29.1121 52.3252 28.7613C51.9647 28.3663 51.3963 28.3787 51.1506 28.8834C50.9441 29.3076 50.2798 28.9863 50.4876 28.5605C50.9202 27.6714 52.1117 27.4484 52.8011 28.2032L52.8012 28.2039Z" fill="black"/>
            <path d="M34.2586 40.7345C32.4488 40.0543 30.5476 39.6666 28.6201 39.565C28.1496 39.5402 28.2782 38.8166 28.7466 38.8415C30.74 38.9461 32.696 39.3658 34.5672 40.0693C35.0108 40.2361 34.7016 40.9014 34.2586 40.7345Z" fill="black"/>
            <path d="M28.5841 36.0281C28.1171 35.9523 28.2421 35.2289 28.7107 35.3053C31.9975 35.8383 35.3705 35.6971 38.5898 34.8739C39.0435 34.7576 39.3099 35.4449 38.8525 35.5615C35.5013 36.418 32.0081 36.5834 28.5841 36.0281Z" fill="black"/>
            <path d="M30.0553 32.2145C29.5888 32.1991 29.5122 31.4671 29.9846 31.4828C32.6762 31.5724 35.3391 31.0742 37.8057 30.0114C38.2401 29.8245 38.5008 30.5132 38.0685 30.6992C35.5487 31.7846 32.8047 32.3063 30.0553 32.2145Z" fill="black"/>
            <path d="M28.1867 29.1159C27.7157 29.1311 27.6421 28.3994 28.116 28.384C30.0823 28.3202 31.9841 27.8177 33.7235 26.9098C34.1417 26.6919 34.3996 27.3826 33.9863 27.5978C32.1957 28.5325 30.2105 29.0499 28.1867 29.1159Z" fill="black"/>
            <path d="M21.8891 30.9033C21.4214 30.8923 21.3454 30.16 21.8183 30.1712C22.6722 30.1909 23.5096 30.0164 24.2634 29.6124C24.6748 29.3921 25.109 29.9888 24.6942 30.2108C23.8237 30.6771 22.8828 30.9259 21.8891 30.9033Z" fill="black"/>
            <path d="M24.2564 39.3124L22.512 39.2326C22.041 39.2109 22.1704 38.4879 22.6384 38.5092C23.2199 38.5358 23.8014 38.5624 24.3828 38.589C24.8538 38.6108 24.7244 39.3337 24.2564 39.3124Z" fill="black"/>
            <path d="M22.4092 34.8711C21.9385 34.8213 22.0657 34.0979 22.5357 34.1478C23.3629 34.2349 24.1623 34.0727 24.9019 33.7046C25.3246 33.4944 25.5832 34.1844 25.1648 34.3928C24.3062 34.8203 23.364 34.9718 22.4092 34.8711Z" fill="black"/>
            <path d="M17.4255 33.0416C16.9572 32.9723 17.0829 32.2482 17.5519 32.3181C17.9138 32.3719 18.2644 32.3403 18.6097 32.2227C19.0565 32.0709 19.3203 32.7592 18.8727 32.9111C18.4023 33.071 17.9191 33.1145 17.4255 33.0416Z" fill="black"/>
            <path d="M18.9163 37.0933C18.4336 37.0052 17.9517 36.9172 17.4689 36.8284C17.0035 36.7433 17.1276 36.0191 17.5953 36.1048C18.078 36.1928 18.56 36.2809 19.0427 36.3696C19.5081 36.4547 19.384 37.1789 18.9163 37.0933Z" fill="black"/>
          </g>
          <path d="M43.8415 19.9279C42.4989 20.9745 40.1193 23.6526 42.1754 24.0762C44.1915 24.4915 44.0734 21.6468 43.8415 19.9279Z" fill="#B2E9F1"/>
          <path d="M45.1384 23.7169C43.7958 24.7635 41.4162 27.4417 43.4723 27.8652C45.4884 28.2805 45.3703 25.4359 45.1384 23.7169Z" fill="#B2E9F1"/>
      `;
    }

    this.svg.appendChild(icon);

    // 아이콘을 바깥쪽(윗부분)에 배치하기 위한 오프셋 추가
    const outerOffset = value > this.config.maxValue ? 30 : 40; // 반원 바깥쪽으로 40px 이동

    // 아이콘을 게이지 진행 방향 뒤쪽으로 이동
    const angleOffset = -3; // 각도를 10도 뒤로 (음수 = 뒤로, 양수 = 앞으로)

    if (shouldAnimate) {
      const startAngle = -180 + 0.14 * 180; // 15% 시작점

      // 초기 위치 설정
      const startPos = this.polarToCartesian(
        this.center,
        this.center,
        this.radius + outerOffset,
        startAngle
      );

      // 아이콘 크기에 따라 중앙 정렬 오프셋 조정
      let offsetX, offsetY;
      if (value > this.config.maxValue) {
        // 로켓: 18×48
        offsetX = 9;
        offsetY = 24;
      } else {
        // 달팽이: 50×43
        offsetX = 25;
        offsetY = 21.5;
      }

      icon.setAttribute(
        "transform",
        `translate(${startPos.x - offsetX}, ${startPos.y - offsetY})`
      );

      if (value > this.config.maxValue) {
        // 초과 시: 15% → 100% (끝까지 가서 고정)
        const fullAngle = 0; // 100% 지점
        const duration = 1400;
        const startTime = performance.now();

        const animate = (currentTime) => {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easeOut = 1 - Math.pow(1 - progress, 3);

          const currentAngle = startAngle + (fullAngle - startAngle) * easeOut;
          const currentPos = this.polarToCartesian(
            this.center,
            this.center,
            this.radius + outerOffset,
            currentAngle + angleOffset
          );

          // 아이콘 회전 각도 계산
          const iconRotation = currentAngle;

          icon.setAttribute(
            "transform",
            `translate(${currentPos.x - offsetX}, ${currentPos.y - offsetY}) rotate(${iconRotation}, ${offsetX}, ${offsetY})`
          );

          if (progress < 1) {
            requestAnimationFrame(animate);
          }
        };

        requestAnimationFrame(animate);
      } else {
        // 50% 미만: 15% → 최종 angle (게이지 따라가기)
        const duration = 1400;
        const startTime = performance.now();

        const animate = (currentTime) => {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easeOut = 1 - Math.pow(1 - progress, 3);

          const currentAngle = startAngle + (angle - startAngle) * easeOut;
          const currentPos = this.polarToCartesian(
            this.center,
            this.center,
            this.radius + outerOffset,
            currentAngle + angleOffset
          );

          // 아이콘 회전 각도 계산 (게이지 각도에 따라 회전)
          const iconRotation = currentAngle + 90; // 기본 -30.21도에서 시작

          icon.setAttribute(
            "transform",
            `translate(${currentPos.x - offsetX}, ${currentPos.y - offsetY}) rotate(${iconRotation}, ${offsetX}, ${offsetY})`
          );

          if (progress < 1) {
            requestAnimationFrame(animate);
          }
        };

        requestAnimationFrame(animate);
      }
    } else {
      // 애니메이션 없이 바로 최종 위치
      let finalAngle;
      if (value > this.config.maxValue) {
        finalAngle = 0; // 100% 위치
      } else {
        finalAngle = angle; // 게이지 끝 위치
      }

      const iconPos = this.polarToCartesian(
        this.center,
        this.center,
        this.radius,
        finalAngle
      );

      // 아이콘 크기에 따라 중앙 정렬 오프셋 조정
      let offsetX, offsetY;
      if (value > this.config.maxValue) {
        offsetX = 9;
        offsetY = 24;
      } else {
        offsetX = 25;
        offsetY = 21.5;
      }

      icon.setAttribute(
        "transform",
        `translate(${iconPos.x - offsetX}, ${iconPos.y - offsetY})`
      );
    }
  }

  // "전체 평균 학습" 텍스트 추가
  addAverageLearningText(value, percent) {
    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
    text.setAttribute("font-size", "16");
    text.setAttribute("font-weight", "400");
    text.setAttribute("fill", "#4A4947");

    const textPath = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "textPath"
    );
    textPath.setAttributeNS(
      "http://www.w3.org/1999/xlink",
      "xlink:href",
      "#innerArc"
    );
    if (value > this.config.maxValue) {
      textPath.setAttribute("startOffset", `${Math.max(10, percent * 100)}%`);
    } else {
      textPath.setAttribute("startOffset", "100%");
    }
    textPath.setAttribute("text-anchor", "end");
    textPath.innerHTML = `전체 평균 학습`;

    text.appendChild(textPath);
    this.svg.appendChild(text);
  }
}
