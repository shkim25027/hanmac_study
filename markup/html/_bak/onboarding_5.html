<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í¼ì¦ ì˜¨ë³´ë”© - ì¡°ê°ë³„ ìƒíƒœ ì œì–´</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          "Noto Sans KR",
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        color: white;
      }

      .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .header .subtitle {
        font-size: 20px;
        color: #ffd700;
        font-weight: bold;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .progress-bar {
        width: 100%;
        max-width: 1500px;
        height: 10px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        margin-bottom: 30px;
        overflow: hidden;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4caf50, #8bc34a);
        width: 0%;
        transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
      }

      .puzzle-container {
        position: relative;
        width: 100%;
        max-width: 1500px;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      .puzzle-board {
        position: relative;
        width: 100%;
      }

      svg {
        width: 100%;
        height: auto;
        display: block;
      }

      /* ê° í¼ì¦ ì¡°ê° ê·¸ë£¹ */
      .puzzle-piece-group {
        cursor: pointer;
      }

      /* ê¸°ë³¸ ìƒíƒœ: íˆ¬ëª… ì˜¤ë²„ë ˆì´ */
      .piece-overlay-base {
        fill: white;
        fill-opacity: 0;
        transition: all 0.3s ease;
      }

      /* í˜¸ë²„ ìƒíƒœ: ì–´ë‘ìš´ ì˜¤ë²„ë ˆì´ */
      .piece-overlay-hover {
        fill: black;
        fill-opacity: 0;
        transition: all 0.3s ease;
        pointer-events: none;
      }

      .puzzle-piece-group:hover .piece-overlay-hover {
        fill-opacity: 0.3;
      }

      /* ì™„ë£Œ ìƒíƒœ: ë°ì€ ì˜¤ë²„ë ˆì´ */
      .puzzle-piece-group:not(.completed) .piece-overlay-base {
        fill: white;
        fill-opacity: 0.6;
      }

      .puzzle-piece-group:not(.completed)[data-piece="1"] .piece-overlay-base,
      .puzzle-piece-group:not(.completed)[data-piece="6"] .piece-overlay-base {
        fill: #1d375d;
        fill-opacity: 0.2;
      }
      .puzzle-piece-group:not(.completed)[data-piece="2"] .piece-overlay-base,
      .puzzle-piece-group:not(.completed)[data-piece="3"] .piece-overlay-base,
      .puzzle-piece-group:not(.completed)[data-piece="4"] .piece-overlay-base,
      .puzzle-piece-group:not(.completed)[data-piece="5"] .piece-overlay-base {
        fill: #662a0d;
        fill-opacity: 0.2;
      }
      .puzzle-piece-group:not(.completed)[data-piece="8"] .piece-overlay-base,
      .puzzle-piece-group:not(.completed)[data-piece="7"] .piece-overlay-base {
        fill: #5b4822;
        fill-opacity: 0.2;
      }
      .puzzle-piece-group:not(.completed)[data-piece="9"] .piece-overlay-base,
      .puzzle-piece-group:not(.completed)[data-piece="10"] .piece-overlay-base {
        fill: #2a5338;
        fill-opacity: 0.2;
      }
      .puzzle-piece-group.completed:hover .piece-overlay-hover {
        fill-opacity: 0;
      }

      /* ì¶•í•˜ ë©”ì‹œì§€ */
      .celebration {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        text-align: center;
        background: white;
        padding: 60px 80px;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        opacity: 0;
        z-index: 100;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .celebration.show {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      .celebration h2 {
        font-size: 36px;
        color: #27ae60;
        margin-bottom: 20px;
      }

      .celebration p {
        font-size: 20px;
        color: #7f8c8d;
        line-height: 1.6;
      }

      .celebration-emoji {
        font-size: 64px;
        margin-bottom: 20px;
        display: block;
        animation: bounce 1s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      /* í†µê³„ */
      .stats {
        margin-top: 30px;
        text-align: center;
        background: white;
        padding: 20px 40px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      }

      .stats p {
        font-size: 16px;
        color: #2c3e50;
        font-weight: 600;
      }

      .stats span {
        color: #3498db;
        font-size: 20px;
      }

      /* ë°°ê²½ ì˜¤ë²„ë ˆì´ */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        opacity: 0;
        pointer-events: none;
        z-index: 99;
        transition: opacity 0.3s ease;
      }

      .overlay.show {
        opacity: 1;
        pointer-events: auto;
      }

      /* ì•ˆë‚´ ë©”ì‹œì§€ */
      .info-box {
        max-width: 1500px;
        width: 100%;
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        border-radius: 12px;
        padding: 15px 20px;
        margin-bottom: 20px;
        color: #0c5460;
      }

      .info-box strong {
        color: #0c5460;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>í™ê¸¸ë™ ì„ ì„ì—°êµ¬ì›ë‹˜, ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.</h1>
      <p class="subtitle">ì˜¨ë³´ë”© í•„ìˆ˜ ì½˜í…ì¸  ì‹œì²­ì„ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.</p>
    </div>

    <div class="info-box">
      <strong>ğŸ’¡ ì¡°ê°ë³„ ìƒíƒœ ì œì–´:</strong> ê° í¼ì¦ ì¡°ê°ì„ ê°œë³„ì ìœ¼ë¡œ
      í´ë¦­í•˜ì„¸ìš”! ê¸°ë³¸ â†’ í˜¸ë²„(ë§ˆìš°ìŠ¤) â†’ ì™„ë£Œ(í´ë¦­) |
      <strong>ğŸ–¼ï¸ ë°°ê²½ ì´ë¯¸ì§€:</strong> ê° ì¡°ê°ì— ì´ë¯¸ì§€ê°€ ì ìš©ë©ë‹ˆë‹¤ (ê²½ë¡œ:
      ./images/piece1.jpg ~ piece10.jpg)
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="puzzle-container">
      <div class="puzzle-board" id="puzzleBoard">
        <!-- SVGê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
      </div>
    </div>

    <div class="stats">
      <p>ì™„ë£Œëœ ì½˜í…ì¸ : <span id="completedCount">0</span> / 10</p>
    </div>

    <div class="overlay" id="overlay"></div>

    <div class="celebration" id="celebration">
      <span class="celebration-emoji">ğŸ‰</span>
      <h2>ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
      <p>ëª¨ë“  ì˜¨ë³´ë”© ì½˜í…ì¸ ë¥¼<br />ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤!</p>
    </div>

    <script>
      // í¼ì¦ ì¡°ê° ì •ë³´ (10ê°œ)
      const pieces = [
        {
          id: 1,
          title: "ì¶•ì ì˜ ì‹œê°„",
          path: "M60.5 525.5L88.5 393L703.5 391L689.5 640H271L292 525.5H60.5Z",
        },
        {
          id: 2,
          title: "ìƒìš© S/W ì†Œê°œ",
          path: "M715 197L724 16L1112 16L1120 197H715Z",
        },
        {
          id: 3,
          title: "ìƒˆë¡œìš´ ì‹œëŒ€ ì¤€ë¹„ëœ ìš°ë¦¬",
          path: "M1120.5 197L1112 16H1511L1533 195L1120.5 197Z",
        },
        {
          id: 4,
          title: "ê¸°ìˆ ê°œë°œì„¼í„° ì†Œê°œ",
          path: "M1128 387.5L1120 197.5L1533.5 194L1560.5 387.5H1128Z",
        },
        {
          id: 5,
          title: "í•œë§¥ê°€ì¡± ì†Œê°œ ë° ê²½ì˜ì´ë…",
          path: "M705.5 387.5L715.5 197.5L1120 197.876L1128 387.5H705.5Z",
        },
        {
          id: 6,
          title: "ê±´ì„¤ì‚°ì—…ì˜ ë””ì§€í„¸ ì „í™˜",
          path: "M691.5 640L705 391L1128 389.5L1138.5 640H691.5Z",
        },
        {
          id: 7,
          title: "íšŒì‚¬ìƒí™œ (ì‹ ê·œì…ì‚¬ìí¸)",
          path: "M1138 640L1128 389.5H1559.5L1599.5 640H1138Z",
        },
        {
          id: 8,
          title: "íšŒì‚¬ìƒí™œ (ê²½ë ¥)",
          path: "M1569 455L1533.5 194.5H1752L1800 449.5L1569 455Z",
        },
        {
          id: 9,
          title: "ê°€ì¡±ì‚¬ì†Œê°œ",
          path: "M359 17.5L335.5 192.5H426.5L401.5 389H702L723 17.5H359Z",
        },
        {
          id: 10,
          title: "ì™œ ë‹¤ì›Œì¸ì¸ê°€ (ìµœì¬ì²œêµìˆ˜)",
          path: "M88.5 390L124 193H426L402.5 389L88.5 390Z",
        },
      ];

      let completed = 0;
      const totalPieces = pieces.length;

      // SVG ìƒì„±
      function initializePuzzle() {
        const puzzleBoard = document.getElementById("puzzleBoard");

        // SVG ì»¨í…Œì´ë„ˆ ìƒì„±
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("viewBox", "0 0 1862 664");
        svg.setAttribute("fill", "none");

        // defs ì¶”ê°€ (ê·¸ë¼ë””ì–¸íŠ¸)
        const defs = document.createElementNS(svgNS, "defs");

        // ë³´ë“œ ë°°ê²½ ê·¸ë¼ë””ì–¸íŠ¸
        const gradients = [
          {
            id: "board_fill_1",
            stops: [
              { offset: "0%", color: "#2A5338" },
              { offset: "100%", color: "#306843" },
            ],
          },
          {
            id: "board_fill_2",
            stops: [
              { offset: "0%", color: "#662A0D" },
              { offset: "100%", color: "#8E2F00" },
            ],
          },
          {
            id: "board_fill_3",
            stops: [
              { offset: "0%", color: "#1D375D" },
              { offset: "100%", color: "#385888" },
            ],
          },
          {
            id: "board_fill_4",
            stops: [
              { offset: "0%", color: "#5B4822" },
              { offset: "100%", color: "#795711" },
            ],
          },
        ];

        gradients.forEach((grad) => {
          const gradient = document.createElementNS(svgNS, "linearGradient");
          gradient.setAttribute("id", grad.id);
          grad.stops.forEach((stop) => {
            const stopEl = document.createElementNS(svgNS, "stop");
            stopEl.setAttribute("offset", stop.offset);
            stopEl.setAttribute("stop-color", stop.color);
            gradient.appendChild(stopEl);
          });
          defs.appendChild(gradient);
        });

        svg.appendChild(defs);

        // â­ ì „ì²´ ì´ë¯¸ì§€ë¥¼ ì¡°ê°ë³„ë¡œ ë‚˜ëˆ„ê¸° (3ê°€ì§€ ìƒíƒœ)
        // ì „ì²´ í¼ì¦ í¬ê¸°: viewBox 0 0 1862 664
        // ì´ë¯¸ì§€ í¬ê¸°: 1750x625 (ìë™ìœ¼ë¡œ í¼ì¦ í¬ê¸°ì— ë§ì¶°ì§)

        // 3ê°€ì§€ ë°°ê²½ ì´ë¯¸ì§€
        const images = {
          base: "./assets/images/bg_piece.png", // ê¸°ë³¸ ìƒíƒœ
          completed: "./assets/images/bg_piece_completed.png", // ê°œë³„ ì™„ë£Œ ìƒíƒœ
          allCompleted: "./assets/images/bg_piece_all_completed.png", // ì „ì²´ ì™„ë£Œ ìƒíƒœ
        };

        pieces.forEach((piece, index) => {
          // 1. ê¸°ë³¸ ìƒíƒœ íŒ¨í„´
          const patternBase = document.createElementNS(svgNS, "pattern");
          patternBase.setAttribute("id", `bg-image-${piece.id}`);
          patternBase.setAttribute("patternUnits", "userSpaceOnUse");
          patternBase.setAttribute("patternContentUnits", "userSpaceOnUse");
          patternBase.setAttribute("x", "0");
          patternBase.setAttribute("y", "0");
          patternBase.setAttribute("width", "1862");
          patternBase.setAttribute("height", "664");

          const imageBase = document.createElementNS(svgNS, "image");
          imageBase.setAttributeNS(
            "http://www.w3.org/1999/xlink",
            "xlink:href",
            images.base
          );
          imageBase.setAttribute("href", images.base);
          imageBase.setAttribute("x", "0");
          imageBase.setAttribute("y", "0");
          imageBase.setAttribute("width", "1862");
          imageBase.setAttribute("height", "664");
          imageBase.setAttribute("preserveAspectRatio", "none");

          patternBase.appendChild(imageBase);
          defs.appendChild(patternBase);

          // 2. ê°œë³„ ì™„ë£Œ ìƒíƒœ íŒ¨í„´
          const patternCompleted = document.createElementNS(svgNS, "pattern");
          patternCompleted.setAttribute("id", `bg-image-completed-${piece.id}`);
          patternCompleted.setAttribute("patternUnits", "userSpaceOnUse");
          patternCompleted.setAttribute(
            "patternContentUnits",
            "userSpaceOnUse"
          );
          patternCompleted.setAttribute("x", "0");
          patternCompleted.setAttribute("y", "0");
          patternCompleted.setAttribute("width", "1862");
          patternCompleted.setAttribute("height", "664");

          const imageCompleted = document.createElementNS(svgNS, "image");
          imageCompleted.setAttributeNS(
            "http://www.w3.org/1999/xlink",
            "xlink:href",
            images.completed
          );
          imageCompleted.setAttribute("href", images.completed);
          imageCompleted.setAttribute("x", "0");
          imageCompleted.setAttribute("y", "0");
          imageCompleted.setAttribute("width", "1862");
          imageCompleted.setAttribute("height", "664");
          imageCompleted.setAttribute("preserveAspectRatio", "none");

          patternCompleted.appendChild(imageCompleted);
          defs.appendChild(patternCompleted);

          // 3. ì „ì²´ ì™„ë£Œ ìƒíƒœ íŒ¨í„´
          const patternAllCompleted = document.createElementNS(
            svgNS,
            "pattern"
          );
          patternAllCompleted.setAttribute(
            "id",
            `bg-image-all-completed-${piece.id}`
          );
          patternAllCompleted.setAttribute("patternUnits", "userSpaceOnUse");
          patternAllCompleted.setAttribute(
            "patternContentUnits",
            "userSpaceOnUse"
          );
          patternAllCompleted.setAttribute("x", "0");
          patternAllCompleted.setAttribute("y", "0");
          patternAllCompleted.setAttribute("width", "1862");
          patternAllCompleted.setAttribute("height", "664");

          const imageAllCompleted = document.createElementNS(svgNS, "image");
          imageAllCompleted.setAttributeNS(
            "http://www.w3.org/1999/xlink",
            "xlink:href",
            images.allCompleted
          );
          imageAllCompleted.setAttribute("href", images.allCompleted);
          imageAllCompleted.setAttribute("x", "0");
          imageAllCompleted.setAttribute("y", "0");
          imageAllCompleted.setAttribute("width", "1862");
          imageAllCompleted.setAttribute("height", "664");
          imageAllCompleted.setAttribute("preserveAspectRatio", "none");

          patternAllCompleted.appendChild(imageAllCompleted);
          defs.appendChild(patternAllCompleted);

          console.log(`ì¡°ê° ${piece.id}: 3ê°€ì§€ ìƒíƒœ íŒ¨í„´ ìƒì„±ë¨`);
        });

        // ë³´ë“œ ë°°ê²½ (4ê°œì˜ ìƒ‰ìƒ ì˜ì—­)
        const boardPaths = [
          {
            d: "M703.993 381.536L723.919 10.5389C724.226 4.81364 719.667 0.00266044 713.933 0.00263375L156.183 3.71752e-05C151.512 1.54325e-05 147.464 3.23277 146.43 7.78739L62.2553 378.787C60.8358 385.044 65.5917 391 72.0074 391H206.029H694.007C699.322 391 703.708 386.843 703.993 381.536Z",
            fill: "url(#board_fill_1)",
          },
          {
            d: "M715.463 185.541L723.546 9.54123C723.791 4.20239 728.191 0 733.535 0H1722.28C1727.05 0 1731.15 3.36972 1732.09 8.04852L1767.1 184.049C1768.34 190.234 1763.6 196 1757.3 196H1534.35H725.452C719.749 196 715.201 191.238 715.463 185.541Z",
            fill: "url(#board_fill_2)",
          },
          {
            d: "M1139.73 645.293L1122.14 397.293C1121.77 392.058 1117.42 388 1112.17 388H70.206C65.5347 388 61.4858 391.234 60.4533 395.79L4.25149 643.79C2.83375 650.046 7.58954 656 14.0042 656H86.649H1129.75C1135.55 656 1140.14 651.08 1139.73 645.293Z",
            fill: "url(#board_fill_3)",
          },
          {
            d: "M1139.6 646.401L1121.9 207.399C1121.67 201.723 1126.21 196.996 1131.9 196.996H1761.43C1766.22 196.996 1770.33 200.382 1771.25 205.076L1857.15 644.078C1858.36 650.254 1853.63 655.998 1847.34 655.998H1627.13H1149.59C1144.22 655.998 1139.81 651.763 1139.6 646.401Z",
            fill: "url(#board_fill_4)",
          },
        ];

        boardPaths.forEach((board) => {
          const path = document.createElementNS(svgNS, "path");
          path.setAttribute("d", board.d);
          path.setAttribute("fill", board.fill);
          svg.appendChild(path);
        });

        // í¼ì¦ ì¡°ê°ë“¤ ìƒì„±
        pieces.forEach((piece, index) => {
          const group = document.createElementNS(svgNS, "g");
          group.classList.add("puzzle-piece-group");
          group.setAttribute("data-piece", piece.id);
          group.setAttribute("data-title", piece.title);

          // ë°°ê²½ìƒ‰ ë ˆì´ì–´ (ë¯¸ì™„ë£Œ ìƒíƒœì—ë§Œ í‘œì‹œ)
          const bgColorPath = document.createElementNS(svgNS, "path");
          bgColorPath.setAttribute("d", piece.path);
          bgColorPath.setAttribute("class", "piece-bg-color");
          bgColorPath.setAttribute("fill", "#fff"); // ì¡°ê°ë³„ ìƒ‰ìƒ
          bgColorPath.setAttribute("fill-opacity", "0. "); // íˆ¬ëª…ë„ ì¡°ì ˆ
          group.appendChild(bgColorPath);

          // ì´ë¯¸ì§€ ë ˆì´ì–´ (3ê°œ - ê¸°ë³¸, ì™„ë£Œ, ì „ì²´ì™„ë£Œ)
          const currentUrl = window.location.href.split("#")[0];

          // 1. ê¸°ë³¸ ìƒíƒœ ì´ë¯¸ì§€
          const baseImagePath = document.createElementNS(svgNS, "path");
          baseImagePath.setAttribute("d", piece.path);
          baseImagePath.setAttribute("class", "piece-base-image");
          baseImagePath.setAttribute(
            "fill",
            `url(${currentUrl}#bg-image-${piece.id})`
          );
          baseImagePath.setAttribute("fill-opacity", "0.8"); // ë°°ê²½ìƒ‰ì´ ì‚´ì§ ë¹„ì¹˜ë„ë¡
          group.appendChild(baseImagePath);

          // 2. ê°œë³„ ì™„ë£Œ ìƒíƒœ ì´ë¯¸ì§€
          const completedImagePath = document.createElementNS(svgNS, "path");
          completedImagePath.setAttribute("d", piece.path);
          completedImagePath.setAttribute("class", "piece-completed-image");
          completedImagePath.setAttribute(
            "fill",
            `url(${currentUrl}#bg-image-completed-${piece.id})`
          );
          completedImagePath.setAttribute("fill-opacity", "1.0"); // ì™„ë£Œ ì‹œ ë¶ˆíˆ¬ëª…
          completedImagePath.style.display = "none";
          group.appendChild(completedImagePath);

          // 3. ì „ì²´ ì™„ë£Œ ìƒíƒœ ì´ë¯¸ì§€
          const allCompletedImagePath = document.createElementNS(svgNS, "path");
          allCompletedImagePath.setAttribute("d", piece.path);
          allCompletedImagePath.setAttribute(
            "class",
            "piece-all-completed-image"
          );
          allCompletedImagePath.setAttribute(
            "fill",
            `url(${currentUrl}#bg-image-all-completed-${piece.id})`
          );
          allCompletedImagePath.setAttribute("fill-opacity", "1.0"); // ì „ì²´ ì™„ë£Œ ì‹œ ë¶ˆíˆ¬ëª…
          allCompletedImagePath.style.display = "none";
          group.appendChild(allCompletedImagePath);

          console.log(
            `ì¡°ê° ${piece.id}: ë°°ê²½ìƒ‰ + 3ê°€ì§€ ìƒíƒœ ì´ë¯¸ì§€ ë ˆì´ì–´ ìƒì„±`
          );

          // ê¸°ë³¸ ì˜¤ë²„ë ˆì´ (ì™„ë£Œ ì‹œ ë°ê²Œ)
          const overlayBase = document.createElementNS(svgNS, "path");
          overlayBase.setAttribute("d", piece.path);
          overlayBase.classList.add("piece-overlay-base");
          group.appendChild(overlayBase);

          // í˜¸ë²„ ì˜¤ë²„ë ˆì´ (ì–´ë‘ìš´ íš¨ê³¼)
          const overlayHover = document.createElementNS(svgNS, "path");
          overlayHover.setAttribute("d", piece.path);
          overlayHover.classList.add("piece-overlay-hover");
          group.appendChild(overlayHover);

          // í´ë¦­ ì´ë²¤íŠ¸
          group.addEventListener("click", function () {
            const pieceId = this.getAttribute("data-piece");
            const pieceTitle = this.getAttribute("data-title");

            // AJAXë¡œ ëª¨ë‹¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            openModalWithAjax(pieceId, pieceTitle, this);
          });

          svg.appendChild(group);
        });

        puzzleBoard.appendChild(svg);
      }

      // AJAX ëª¨ë‹¬ í˜¸ì¶œ í•¨ìˆ˜
      function openModalWithAjax(pieceId, pieceTitle, pieceElement) {
        console.log(`ì¡°ê° ${pieceId} (${pieceTitle}) í´ë¦­ë¨`);

        // AJAX ìš”ì²­
        fetch(`/api/content/${pieceId}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            // ëª¨ë‹¬ì— ë°ì´í„° í‘œì‹œ
            showContentModal(data, pieceId, pieceTitle, pieceElement);
          })
          .catch((error) => {
            console.error("Error fetching content:", error);
            // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ ëª¨ë‹¬ í‘œì‹œ
            showContentModal(
              {
                title: pieceTitle,
                description: "ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                videoUrl: null,
              },
              pieceId,
              pieceTitle,
              pieceElement
            );
          });
      }

      // ì½˜í…ì¸  ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
      function showContentModal(data, pieceId, pieceTitle, pieceElement) {
        // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
        const existingModal = document.getElementById("contentModal");
        if (existingModal) {
          existingModal.remove();
        }

        // ëª¨ë‹¬ ìƒì„±
        const modal = document.createElement("div");
        modal.id = "contentModal";
        modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;

        // ëª¨ë‹¬ ë‚´ìš©
        modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 800px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    position: relative;
                    animation: slideUp 0.3s ease;
                ">
                    <button id="closeModal" style="
                        position: absolute;
                        top: 20px;
                        right: 20px;
                        background: #e74c3c;
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 40px;
                        height: 40px;
                        font-size: 24px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.2s ease;
                    " onmouseover="this.style.background='#c0392b'" onmouseout="this.style.background='#e74c3c'">
                        Ã—
                    </button>
                    
                    <h2 style="
                        color: #2c3e50;
                        font-size: 28px;
                        margin-bottom: 20px;
                        padding-right: 40px;
                    ">${data.title || pieceTitle}</h2>
                    
                    <div style="
                        color: #7f8c8d;
                        font-size: 16px;
                        line-height: 1.8;
                        margin-bottom: 30px;
                    ">
                        ${data.description || "ì½˜í…ì¸  ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."}
                    </div>
                    
                    ${
                      data.videoUrl
                        ? `
                        <div style="
                            width: 100%;
                            aspect-ratio: 16/9;
                            background: #000;
                            border-radius: 12px;
                            margin-bottom: 30px;
                            overflow: hidden;
                        ">
                            <iframe 
                                src="${data.videoUrl}" 
                                style="width: 100%; height: 100%; border: none;"
                                allowfullscreen>
                            </iframe>
                        </div>
                    `
                        : `
                        <div style="
                            width: 100%;
                            height: 300px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            border-radius: 12px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-size: 20px;
                            margin-bottom: 30px;
                        ">
                            ğŸ¬ ë¹„ë””ì˜¤ ì½˜í…ì¸ 
                        </div>
                    `
                    }
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button id="markCompleteBtn" style="
                            background: #27ae60;
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s ease;
                        " onmouseover="this.style.background='#229954'" onmouseout="this.style.background='#27ae60'">
                            âœ“ ì™„ë£Œ ì²˜ë¦¬
                        </button>
                        
                        <button id="closeModalBtn" style="
                            background: #95a5a6;
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s ease;
                        " onmouseover="this.style.background='#7f8c8d'" onmouseout="this.style.background='#95a5a6'">
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            `;

        // ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ ì¶”ê°€
        const style = document.createElement("style");
        style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
            `;
        document.head.appendChild(style);

        document.body.appendChild(modal);

        // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        const closeButtons = [
          document.getElementById("closeModal"),
          document.getElementById("closeModalBtn"),
        ];

        closeButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            modal.style.animation = "fadeOut 0.3s ease";
            setTimeout(() => modal.remove(), 300);
          });
        });

        // ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.style.animation = "fadeOut 0.3s ease";
            setTimeout(() => modal.remove(), 300);
          }
        });

        // ì™„ë£Œ ì²˜ë¦¬ ë²„íŠ¼
        document
          .getElementById("markCompleteBtn")
          .addEventListener("click", () => {
            markPieceComplete(pieceId, pieceElement);
            modal.style.animation = "fadeOut 0.3s ease";
            setTimeout(() => modal.remove(), 300);
          });
      }

      // í¼ì¦ ì¡°ê° ì™„ë£Œ ì²˜ë¦¬
      function markPieceComplete(pieceId, pieceElement) {
        if (!pieceElement.classList.contains("completed")) {
          // AJAXë¡œ ì„œë²„ì— ì™„ë£Œ ìƒíƒœ ì „ì†¡
          fetch(`/api/content/${pieceId}/complete`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              pieceId: pieceId,
              completedAt: new Date().toISOString(),
            }),
          })
            .then((response) => response.json())
            .then((data) => {
              console.log("ì™„ë£Œ ìƒíƒœ ì €ì¥ë¨:", data);
            })
            .catch((error) => {
              console.error("ì™„ë£Œ ìƒíƒœ ì €ì¥ ì‹¤íŒ¨:", error);
            });

          // UI ì—…ë°ì´íŠ¸: ê°œë³„ ì™„ë£Œ ì´ë¯¸ì§€ë¡œ ì „í™˜
          pieceElement.classList.add("completed");

          // ë°°ê²½ìƒ‰ ìˆ¨ê¸°ê¸°, ì™„ë£Œ ì´ë¯¸ì§€ í‘œì‹œ
          const bgColor = pieceElement.querySelector(".piece-bg-color");
          const baseImage = pieceElement.querySelector(".piece-base-image");
          const completedImage = pieceElement.querySelector(
            ".piece-completed-image"
          );

          if (bgColor) bgColor.style.display = "none";
          if (baseImage) baseImage.style.display = "none";
          if (completedImage) completedImage.style.display = "block";

          completed++;
          updateProgress();

          if (completed === totalPieces) {
            // ì „ì²´ ì™„ë£Œ ì‹œ: ëª¨ë“  ì¡°ê°ì„ ì „ì²´ ì™„ë£Œ ì´ë¯¸ì§€ë¡œ ì „í™˜
            puzzleBoard.classList.add("all-completed");
            document
              .querySelectorAll(".puzzle-piece-group")
              .forEach((group) => {
                const bgCol = group.querySelector(".piece-bg-color");
                const baseImg = group.querySelector(".piece-base-image");
                const completedImg = group.querySelector(
                  ".piece-completed-image"
                );
                const allCompletedImg = group.querySelector(
                  ".piece-all-completed-image"
                );

                if (bgCol) bgCol.style.display = "none";
                if (baseImg) baseImg.style.display = "none";
                if (completedImg) completedImg.style.display = "none";
                if (allCompletedImg) allCompletedImg.style.display = "block";
              });

            setTimeout(showCelebration, 600);
          }

          console.log(`ì¡°ê° ${pieceId} ì™„ë£Œ ì²˜ë¦¬ë¨`);
        }
      }

      function updateProgress() {
        const percentage = (completed / totalPieces) * 100;
        document.getElementById("progressFill").style.width = percentage + "%";
        document.getElementById("completedCount").textContent = completed;
      }

      function showCelebration() {
        document.getElementById("overlay").classList.add("show");
        document.getElementById("celebration").classList.add("show");
      }

      document.getElementById("overlay").addEventListener("click", function () {
        this.classList.remove("show");
        document.getElementById("celebration").classList.remove("show");
      });

      // ì´ˆê¸°í™” í•¨ìˆ˜ - ì´ë¯¸ ì™„ë£Œëœ ì½˜í…ì¸  ì„¤ì •
      function initializeProgress(completedPieces) {
        completedPieces.forEach((pieceNum) => {
          const group = document.querySelector(`[data-piece="${pieceNum}"]`);
          if (group) {
            group.classList.add("completed");
            completed++;
          }
        });
        updateProgress();
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ í¼ì¦ ì´ˆê¸°í™”
      initializePuzzle();

      // í…ŒìŠ¤íŠ¸: ì¼ë¶€ ì¡°ê°ì„ ì™„ë£Œ ìƒíƒœë¡œ ì´ˆê¸°í™”
      // initializeProgress([1, 3, 5]);
    </script>
  </body>
</html>
