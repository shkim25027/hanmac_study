<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>반원형 게이지 바</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background-color: #f5f5f5;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }

      .gauge-container {
        background: white;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .control-panel {
        margin-top: 30px;
        width: 100%;
        max-width: 500px;
      }

      .control-panel label {
        display: block;
        margin-bottom: 10px;
        font-size: 14px;
        color: #333;
        font-weight: 500;
      }

      .control-panel input[type="range"] {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        background: #ddd;
        outline: none;
        cursor: pointer;
      }

      .control-panel input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #e89555;
        cursor: pointer;
      }

      .control-panel input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #e89555;
        cursor: pointer;
        border: none;
      }
    </style>
  </head>
  <body>
    <div class="gauge-container">
      <svg id="gauge" width="500" height="320" viewBox="0 0 500 320"></svg>
    </div>

    <div class="control-panel">
      <label for="valueSlider"
        >학습 시간 조절: <span id="valueDisplay">100</span>분</label
      >
      <input type="range" id="valueSlider" min="0" max="140" value="100" />
    </div>

    <script>
      const svg = document.getElementById("gauge");
      const slider = document.getElementById("valueSlider");
      const valueDisplay = document.getElementById("valueDisplay");

      const size = 500;
      const center = size / 2;
      const radius = 180;
      const strokeWidth = 45;
      const maxValue = 140;

      function ptc(cx, cy, r, angle) {
        const rad = (angle * Math.PI) / 180;
        return {
          x: cx + r * Math.cos(rad),
          y: cy + r * Math.sin(rad),
        };
      }

      function arc(r, start, end) {
        const s = ptc(center, center + 40, r, start);
        const e = ptc(center, center + 40, r, end);
        return `M ${s.x} ${s.y} A ${r} ${r} 0 0 1 ${e.x} ${e.y}`;
      }

      function updateGauge(value) {
        svg.innerHTML = "";

        const percent = Math.min(value / maxValue, 1);
        const angle = -180 + percent * 180;

        // 배경 반원
        const bg = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "path"
        );
        bg.setAttribute("d", arc(radius, -180, 0));
        bg.setAttribute("stroke", "#f2dfc7");
        bg.setAttribute("stroke-width", strokeWidth);
        bg.setAttribute("stroke-linecap", "round");
        bg.setAttribute("fill", "none");
        svg.appendChild(bg);

        // 채워진 반원
        const fg = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "path"
        );
        fg.setAttribute("d", arc(radius, -180, angle));
        fg.setAttribute("stroke", "#e89555");
        fg.setAttribute("stroke-width", strokeWidth);
        fg.setAttribute("stroke-linecap", "round");
        fg.setAttribute("fill", "none");
        svg.appendChild(fg);

        // 텍스트 아크 정의
        const defs = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "defs"
        );
        const textArc = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "path"
        );

        const textRadius = radius - 22;
        textArc.setAttribute("id", "textArc");
        textArc.setAttribute("d", arc(textRadius, -180, 0));
        defs.appendChild(textArc);
        svg.appendChild(defs);

        // 텍스트 생성
        if (percent > 0.15) {
          // 충분히 클 때만 표시
          const text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("font-size", "15");
          text.setAttribute("font-weight", "600");
          text.setAttribute("fill", "white");

          const textPath = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "textPath"
          );
          textPath.setAttributeNS(
            "http://www.w3.org/1999/xlink",
            "xlink:href",
            "#textArc"
          );
          textPath.setAttribute(
            "startOffset",
            `${Math.max(10, percent * 100 - 10)}%`
          );
          textPath.setAttribute("text-anchor", "middle");
          textPath.textContent = `나의 학습 : ${value}분`;

          text.appendChild(textPath);
          svg.appendChild(text);
        }

        // 끝점 원
        const p = ptc(center, center + 40, radius, angle);
        const dot = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "circle"
        );
        dot.setAttribute("cx", p.x);
        dot.setAttribute("cy", p.y);
        dot.setAttribute("r", 18);
        dot.setAttribute("fill", "#e89555");
        svg.appendChild(dot);

        // 최대값 라벨
        const maxLabel = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "text"
        );
        maxLabel.setAttribute("x", size - 20);
        maxLabel.setAttribute("y", center + 80);
        maxLabel.setAttribute("text-anchor", "end");
        maxLabel.setAttribute("fill", "#bbb");
        maxLabel.setAttribute("font-size", "13");
        maxLabel.textContent = `전체 평균 학습 : ${maxValue}분`;
        svg.appendChild(maxLabel);
      }

      // 초기 렌더링
      updateGauge(parseInt(slider.value));

      // 슬라이더 이벤트
      slider.addEventListener("input", function () {
        const value = parseInt(this.value);
        valueDisplay.textContent = value;
        updateGauge(value);
      });
    </script>
  </body>
</html>
